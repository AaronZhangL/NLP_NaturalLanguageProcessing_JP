#! /bin/bash

#出力ファイル
#1 事象　[段1/親-/子孫2-36] 
#1 名詞　[段1/親-/子孫2-2715]
#1 固有名詞　[段1/親-/子孫2-130]
#
#入力ファイル
#GOIFILE="GOI.TXT" ;
# wc 2715
GOIFILE="MEISHI.TXT" ;
#出力ファイル
LIST="LIST.TXT" ;
#
makeList(){
  cat "$GOIFILE" | nkf -wLu | grep "\[" | sed -e "s/　→属性体系へ//" | sort -u |
sort > "$LIST" ;
}
#
#出力ファイル
# wc 2710
#1 1 事象　[段1/親-/子孫2-36]
#1 1 名詞　[段1/親-/子孫2-2715]
#1 1 固有名詞　[段1/親-/子孫2-130]
#
#出力ファイル
DANFILE="DAN.TXT" ;
# INDENT="│ ├ └" ;
sortDan(){
  :>$DANFILE ;
  while read line ; do
    DAN=`echo "$line" | sed -e "s/^.*段//g" -e "s|/.*$||g"` ;
    if [ "$DAN" -eq  "1" ]; then echo "├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "2" ]; then echo "│ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "3" ]; then echo "│ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "4" ]; then echo "│ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "5" ]; then echo "│ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "6" ]; then echo "│ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "7" ]; then echo "│ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "8" ]; then echo "│ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "9" ]; then echo "│ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq "10" ]; then echo "│ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq "11" ]; then echo "│ │ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi 
    if [ "$DAN" -eq "12" ]; then echo "│ │ │ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
  done < "$LIST"
}
#
#親ノードに接続
# wc 2694
OYAFILE="OYA.TXT" ;
#
addOya(){
:> "$OYAFILE" ;
  for (( i=1 ; i <= 11; i++)); do
    echo "$i" ;
    if [ "$i" -eq "1" ]; then
      grep "段$i/" "$DANFILE" > DAN.TMP;
      cat DAN.TMP > "$OYAFILE" ;
    else
      grep "段$i/" "$DANFILE" > DAN.TMP;
      while read line; do
        OYA=`echo "$line" | sed -e "s|^.*親||g" -e "s|\/.*$||g"` ;
        #         space  TAB 
        sed -i -e "/ $OYA /a $line" "$OYAFILE" ;
      done < DAN.TMP
    fi
  done
}
#
TAGFILE="TAG.TXT" ;
addTag(){
  :> "$TAGFILE" ; 
  TAG="" ;
  while read line; do
    OWN=`echo "$line" | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA=`echo "$line" | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
    echo "$line<TAG>$OWN</TAG>" ;
    OWN2=`cat "$OYAFILE" | grep " $OYA " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
      OYA2=`echo "$line" | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
  done < "$OYAFILE" 
}
#
#makeList ;
#sortDan ;
#addOya ;
addTag ;
exit ;

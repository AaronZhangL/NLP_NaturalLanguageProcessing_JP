#! /bin/bash

#出力ファイル
#1 事象　[段1/親-/子孫2-36] 
#1 名詞　[段1/親-/子孫2-2715]
#1 固有名詞　[段1/親-/子孫2-130]
#
#入力ファイル
#GOIFILE="GOI.TXT" ;
# wc 2715
GOIFILE="MEISHI.TXT" ;
#出力ファイル
LIST="LIST.TXT" ;
#
makeList(){
  cat "$GOIFILE" | nkf -wLu | grep "\[" | sed -e "s/　→属性体系へ//" | sort -u |
sort > "$LIST" ;
}
#
#出力ファイル
# wc 2710
#1 1 事象　[段1/親-/子孫2-36]
#1 1 名詞　[段1/親-/子孫2-2715]
#1 1 固有名詞　[段1/親-/子孫2-130]
#
#出力ファイル
DANFILE="DAN.TXT" ;
# INDENT="│ ├ └" ;
sortDan(){
  :>$DANFILE ;
  while read line ; do
    DAN=`echo "$line" | sed -e "s/^.*段//g" -e "s|/.*$||g"` ;
    if [ "$DAN" -eq  "1" ]; then echo "├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "2" ]; then echo "│ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "3" ]; then echo "│ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "4" ]; then echo "│ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "5" ]; then echo "│ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "6" ]; then echo "│ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "7" ]; then echo "│ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "8" ]; then echo "│ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq  "9" ]; then echo "│ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq "10" ]; then echo "│ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
    if [ "$DAN" -eq "11" ]; then echo "│ │ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi 
    if [ "$DAN" -eq "12" ]; then echo "│ │ │ │ │ │ │ │ │ │ │ ├ $line" >> "$DANFILE" ; fi
  done < "$LIST"
}
#
#親ノードに接続
# wc 2710
OYAFILE="OYA.TXT" ;
#
addOya(){
:> "$OYAFILE" ;
  for (( i=1 ; i <= 12; i++)); do
    echo "$i" ;
    if [ "$i" -eq "1" ]; then
      grep "段$i/" "$DANFILE" > DAN.TMP;
      cat DAN.TMP > "$OYAFILE" ;
    else
      grep "段$i/" "$DANFILE" > DAN.TMP;
      while read line; do
        OYA=`echo "$line" | sed -e "s|^.*親||g" -e "s|\/.*$||g"` ;
        #         space  TAB 
        sed -i -e "/ $OYA /a $line" "$OYAFILE" ;
      done < DAN.TMP
    fi
  done
}
#
#
# wc 
TAGFILE="TAG.TXT" ;
addTag(){
  :> "$TAGFILE" ; 
  TAG="" ;
  while read line; do
    OWN=`echo "$line" | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA=`echo "$line" | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN</TAG>" ;

    OWN2=`cat "$OYAFILE" | grep "├ $OYA " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA2=`cat "$OYAFILE" | grep "├ $OWN2 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN2-$OWN</TAG>" ;

    OWN3=`cat "$OYAFILE" | grep "├ $OYA2 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA3=`cat "$OYAFILE" | grep "├ $OWN3 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN3-$OWN2-$OWN</TAG>" ;
    
    OWN4=`cat "$OYAFILE" | grep "├ $OYA3 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA4=`cat "$OYAFILE" | grep "├ $OWN4 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN5=`cat "$OYAFILE" | grep "├ $OYA4 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA5=`cat "$OYAFILE" | grep "├ $OWN5 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN6=`cat "$OYAFILE" | grep "├ $OYA5 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA6=`cat "$OYAFILE" | grep "├ $OWN6 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN7=`cat "$OYAFILE" | grep "├ $OYA6 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA7=`cat "$OYAFILE" | grep "├ $OWN7 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN8=`cat "$OYAFILE" | grep "├ $OYA7 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA8=`cat "$OYAFILE" | grep "├ $OWN8 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN8-$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN9=`cat "$OYAFILE" | grep "├ $OYA8 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA9=`cat "$OYAFILE" | grep "├ $OWN9 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN9-$OWN8-$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN10=`cat "$OYAFILE" | grep "├ $OYA9 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA10=`cat "$OYAFILE" | grep "├ $OWN10 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN10-$OWN9-$OWN8-$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN11=`cat "$OYAFILE" | grep "├ $OYA10 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA11=`cat "$OYAFILE" | grep "├ $OWN11 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
#    echo "$line<TAG>$OWN11-$OWN10-$OWN9-$OWN8-$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" ;

    OWN12=`cat "$OYAFILE" | grep "├ $OYA11 " | sed -e "s/.*├ //g" -e "s/ .*$//g"` ;
    OYA12=`cat "$OYAFILE" | grep "├ $OWN12 " | sed -e "s/^.*親//g" -e "s|/.*$||g"` ;
    echo "$line<TAG>$OWN12-$OWN11-$OWN10-$OWN9-$OWN8-$OWN7-$OWN6-$OWN5-$OWN4-$OWN3-$OWN2-$OWN</TAG>" >> "$TAGFILE" ;
  done < "$OYAFILE" 
}
#
#makeList ;
#sortDan ;
#addOya ;
addTag ;
exit ;
